<!doctype html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="utf-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ù„ÙƒÙŠØ© â€” ØºØ±ÙŠÙ…</title>
  <link rel="stylesheet" href="styles.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* Admin-specific styles */
    .st-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 15px;
      align-items: center;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 12px;
      border: 1px solid #e0e0e0;
      transition: all 0.3s ease;
    }
    
    .st-row:hover {
      background: #fff;
      border-color: var(--accent);
      box-shadow: 0 4px 12px rgba(212, 175, 55, 0.1);
    }
    
    .st-info {
      font-weight: 600;
      color: var(--primary);
      font-size: 1rem;
    }
    
    .st-actions {
      display: flex;
      gap: 8px;
    }
    
    .st-actions button {
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
      background: #fff;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.85rem;
      transition: all 0.2s;
    }
    
    .st-actions button:hover {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }
    
    .order-card {
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      transition: all 0.3s ease;
    }
    
    .order-card:hover {
      border-color: var(--accent);
      box-shadow: 0 4px 12px rgba(212, 175, 55, 0.1);
    }
    
    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
    }
    
    .customer-meta {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
      background: #f9f9f9;
      padding: 12px;
      border-radius: 8px;
    }
    
    .meta-item {
      font-size: 0.9rem;
      color: var(--text);
    }
    
    .meta-item strong {
      color: var(--primary);
      font-weight: 700;
      display: block;
      margin-bottom: 3px;
    }
    
    .order-items-list {
      background: #fafafa;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 15px;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    
    .order-items-list strong {
      color: var(--primary);
    }
    
    .delete-order-btn {
      padding: 10px 20px;
      background: #ff4444;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .delete-order-btn:hover {
      background: #dd0000;
      box-shadow: 0 4px 12px rgba(255, 68, 68, 0.2);
    }
    
    .admin-panel {
      animation: slideUp 0.5s ease;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    #stList {
      max-height: 600px;
      overflow-y: auto;
      padding-right: 10px;
    }
    
    #stList::-webkit-scrollbar {
      width: 8px;
    }
    
    #stList::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
    #stList::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 10px;
    }
    
    #stList::-webkit-scrollbar-thumb:hover {
      background: var(--primary);
    }
  </style>
</head>

<body>
  <div id="app-bg"></div>

  <header class="site-header">
    <div class="container">
      <h1 class="logo">GHARIM â€” ØºØ±ÙŠÙ…</h1>
      <nav class="main-nav">
        <a href="cohee.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <button id="logoutBtn" onclick="logout()"
          style="background: none; border: none; color: var(--text); font-weight: 600; cursor: pointer; font-family: inherit; display: none;">ØªØ³Ø¬ÙŠÙ„
          Ø§Ù„Ø®Ø±ÙˆØ¬</button>
      </nav>
    </div>
  </header>

  <main class="container">
    <div id="offlineNotice" class="offline-banner" style="display:none; margin: 20px 0; padding: 15px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; color: #856404; text-align: center;">
      âš ï¸ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ (localStorage)
    </div>

    <div id="loginPrompt" style="display: none; text-align: center; padding: 60px 20px;">
      <h2 style="color: var(--primary); font-size: 2rem; margin-bottom: 20px;">ğŸ” ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <p style="color: var(--muted); font-size: 1.1rem; margin-bottom: 30px;">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ØªØªØ·Ù„Ø¨ Ø­Ø³Ø§Ø¨Ù‹Ø§ Ù…Ø³Ø¤ÙˆÙ„Ù‹Ø§</p>
      <a href="auth.html" style="display: inline-block; background: var(--primary); color: #fff; padding: 15px 40px; border-radius: 50px; text-decoration: none; font-weight: 700; font-size: 1.1rem;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
    </div>

    <div id="adminContent" style="display: none;">
      <section style="margin: 40px 0;">
        <h2 style="color: var(--primary); font-size: 2.5rem; font-weight: 900; margin-bottom: 30px; text-align: center;">
          ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</h2>

        <!-- Seeding Section -->
        <div id="seed-section"
          style="background: var(--accent-light); padding: 20px; border-radius: 20px; border: 1px dashed var(--accent); margin-bottom: 30px; text-align: center;">
          <h3 style="color: var(--primary); margin-bottom: 10px;">ğŸ”„ Ù…Ø²Ø§Ù…Ù†Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h3>
          <p style="font-size: 0.9rem; color: var(--primary); margin-bottom: 15px;">Ù‚Ù… Ø¨Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ÙØ§Ø®Ø±Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ù„ØªØªÙ…ÙƒÙ† Ù…Ù† ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§.</p>
          <button onclick="seedSampleData()"
            style="background: var(--accent); color: #fff; border: none; padding: 10px 25px; border-radius: 50px; font-weight: 800; cursor: pointer; transition: all 0.3s;">Ù†Ø´Ø±
            Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ù„Ù„Ù€ Database</button>
        </div>

        <div id="orders-container"
          style="background: var(--white); padding: 30px; border-radius: 30px; box-shadow: var(--shadow-md); border: 1px solid rgba(197, 160, 33, 0.1); margin-bottom: 40px;">
          <h3
            style="margin-bottom: 20px; color: var(--primary); border-bottom: 2px solid var(--accent-light); padding-bottom: 10px;">
            ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h3>
          <div id="orders" style="max-height: 500px; overflow-y: auto;"></div>
        </div>
      </section>

      <section class="admin-panel"
        style="background: var(--white); padding: 40px; border-radius: 30px; box-shadow: var(--shadow-lg); border: 1px solid rgba(197, 160, 33, 0.1);">
        <h2 style="color: var(--primary); margin-bottom: 30px;">ğŸ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
        <form id="addSticker" onsubmit="addSticker(event)" style="display: grid; gap: 20px;">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <input id="st_title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†ØªØ¬" required
              style="padding: 15px; border-radius: 12px; border: 1px solid #eee; font-family: inherit;">
            <input id="st_price" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø¯.Ø¹)" type="number" required
              style="padding: 15px; border-radius: 12px; border: 1px solid #eee; font-family: inherit;">
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <input id="st_category" placeholder="Ø§Ù„ØªØµÙ†ÙŠÙ (ØªÙˆØ²ÙŠØ¹Ø§ØªØŒ Ù…ØµØ§Ø­Ù...)"
              style="padding: 15px; border-radius: 12px; border: 1px solid #eee; font-family: inherit;">
            <div style="display: flex; align-items: center; gap: 10px; padding: 0 15px;">
              <input id="st_active" type="checkbox" checked
                style="width: 20px; height: 20px; accent-color: var(--primary);">
              <label for="st_active" style="font-weight: 600;">Ø§Ù„Ù…Ù†ØªØ¬ Ù…ÙØ¹Ù„ ÙˆÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø±</label>
            </div>
          </div>

          <div
            style="padding: 20px; background: var(--bg); border: 1px dashed var(--accent); border-radius: 15px; text-align: center;">
            <label style="display: block; margin-bottom: 10px; font-weight: 700; color: var(--primary);">ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬
              Ø§Ù„ÙØ§Ø®Ø±Ø©</label>
            <input id="st_image" type="file" accept="image/*" style="cursor: pointer;">
            <div id="previewWrap" style="margin-top:15px;display:none">
              <img id="previewImg" src=""
                style="max-width:150px; border-radius:15px; display:inline-block; margin-bottom:10px; box-shadow: var(--shadow-sm);">
              <progress id="uploadProgress" value="0" max="100" style="width:100%; height: 10px; border-radius: 5px;"
                hidden></progress>
            </div>
          </div>

          <button
            style="background: var(--primary); color: #fff; padding: 18px; border: none; border-radius: 15px; font-weight: 900; font-size: 1.1rem; cursor: pointer; transition: var(--transition);">Ø¥Ø¶Ø§ÙØ©
            Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ù„ÙƒÙŠ</button>
        </form>

        <h3 style="margin: 40px 0 20px; color: var(--primary); border-top: 2px solid var(--bg); padding-top: 40px;">ğŸ“‹
          Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
        <div id="stList" style="display: grid; gap: 15px;"></div>
      </section>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase.js"></script>

  <script>
    // Sample products for seeding
    window._sampleProducts = [
      { id: 'p1', title: 'ØªÙˆØ²ÙŠØ¹Ø§Øª Ø¨Ø®ÙˆØ± Ù…Ù„ÙƒÙŠ', price: 5000, category: 'ØªÙˆØ²ÙŠØ¹Ø§Øª', thumb: 'https://images.unsplash.com/photo-1628144450171-ec59a117cb83?q=80&w=400', active: true },
      { id: 'p2', title: 'Ù…ØµØ­Ù Ø§Ù„Ø¬ÙŠØ¨ Ù…ØºÙ„Ù', price: 7500, category: 'ØªÙˆØ²ÙŠØ¹Ø§Øª', thumb: 'https://images.unsplash.com/photo-1542810634-71277d95dcbb?q=80&w=400', active: true },
      { id: 'p3', title: 'Ø³Ø¨Ø­Ø© Ø§Ù„Ø¹Ù‚ÙŠÙ‚ Ø§Ù„ÙØ§Ø®Ø±Ø©', price: 15000, category: 'ØªÙˆØ²ÙŠØ¹Ø§Øª', thumb: 'https://images.unsplash.com/photo-1590074259010-8636cb077e69?q=80&w=400', active: true },
      { id: 'p4', title: 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ø®ÙˆØ± ÙˆØ¹ÙˆØ¯', price: 25000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1541675154750-0444c7d51e8e?q=80&w=400', active: true },
      { id: 'p13', title: 'Ø¹Ù„Ø¨Ø© Ù‡Ø¯Ø§ÙŠØ§ Ø®Ø´Ø¨ÙŠØ© Ù…Ø­ÙÙˆØ±Ø©', price: 12500, category: 'ØªÙˆØ²ÙŠØ¹Ø§Øª', thumb: 'https://images.unsplash.com/photo-1549465220-1a8b9238cd48?q=80&w=400', active: true },
      { id: 'p5', title: 'Ù…ØµØ­Ù Ù…Ø®Ù…Ù„ÙŠ ÙƒØ¨ÙŠØ±', price: 35000, category: 'Ù…ØµØ§Ø­Ù', thumb: 'https://images.unsplash.com/photo-1597933534024-bcbb64dfd6f6?q=80&w=400', active: true },
      { id: 'p6', title: 'Ø­Ø§Ù…Ù„ Ù…ØµØ­Ù Ø®Ø´Ø¨ÙŠ', price: 45000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1584281729155-320077819323?q=80&w=400', active: true },
      { id: 'p7', title: 'Ø·Ù‚Ù… ØµÙ„Ø§Ø© Ù…ØªÙƒØ§Ù…Ù„', price: 65000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1564683214965-3619add9800d?q=80&w=400', active: true },
      { id: 'p14', title: 'Ù…ØµØ­Ù Ø¨Ø§Ù„ØªØ¬Ù„ÙŠØ¯ Ø§Ù„Ø°Ù‡Ø¨ÙŠ', price: 55000, category: 'Ù…ØµØ§Ø­Ù', thumb: 'https://images.unsplash.com/photo-1609599006353-e629aaabfeae?q=80&w=400', active: true },
      { id: 'p8', title: 'Ù‚Ù†ÙŠÙ†Ø© Ø¹Ø·Ø± Ø²ÙŠØªÙŠØ© ÙØ®Ù…Ø©', price: 12000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1523293182086-7651a899d37f?q=80&w=400', active: true },
      { id: 'p9', title: 'Ø¹Ù„Ø¨Ø© Ù‡Ø¯Ø§ÙŠØ§ Ù…Ø·Ø±Ø²Ø©', price: 8500, category: 'ØªÙˆØ²ÙŠØ¹Ø§Øª', thumb: 'https://images.unsplash.com/photo-1549465220-1a8b9238cd48?q=80&w=400', active: true },
      { id: 'p10', title: 'ÙØ§Ù†ÙˆØ³ Ø±Ù…Ø¶Ø§Ù†ÙŠ ÙŠØ¯ÙˆÙŠ', price: 18000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1558227691-41ea78d1f631?q=80&w=400', active: true },
      { id: 'p11', title: 'Ù„ÙˆØ­Ø© Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠ Ù…Ø°Ù‡Ø¨Ø©', price: 95000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1510522134121-2238418b53c3?q=80&w=400', active: true },
      { id: 'p12', title: 'Ø³Ø¬Ø§Ø¯Ø© ØµÙ„Ø§Ø© Ø·Ø¨ÙŠØ©', price: 40000, category: 'Ù…ØµØ§Ø­Ù', thumb: 'https://images.unsplash.com/photo-1554433607-66b5efe9d304?q=80&w=400', active: true },
      { id: 'p15', title: 'ØµÙ†Ø¯ÙˆÙ‚ Ø¨Ø®ÙˆØ± Ø§Ù„ØµÙ†Ø¯Ù„', price: 17000, category: 'ØªÙˆØ²ÙŠØ¹Ø§Øª', thumb: 'https://images.unsplash.com/photo-1628144450171-ec59a117cb83?q=80&w=400', active: true },
      { id: 'p16', title: 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ø°ÙƒØ§Ø± Ø§Ù„ÙØ§Ø®Ø±Ø©', price: 9000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1542810634-71277d95dcbb?q=80&w=400', active: true },
      { id: 'p17', title: 'Ø¨Ø³Ø§Ø· ØµÙ„Ø§Ø© Ø£Ø«Ø±ÙŠ', price: 120000, category: 'Ù…ØµØ§Ø­Ù', thumb: 'https://images.unsplash.com/photo-1554433607-66b5efe9d304?q=80&w=400', active: true },
      { id: 'p18', title: 'Ù…Ø¨Ø®Ø±Ø© Ù†Ø­Ø§Ø³ÙŠØ© ÙŠØ¯ÙˆÙŠØ©', price: 32000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1541675154750-0444c7d51e8e?q=80&w=400', active: true },
      { id: 'p19', title: 'Ø·Ù‚Ù… Ø³Ø¨Ø­Ø© ÙˆÙ…ØµØ­Ù Ø¬ÙŠØ¨', price: 14000, category: 'ØªÙˆØ²ÙŠØ¹Ø§Øª', thumb: 'https://images.unsplash.com/photo-1590074259010-8636cb077e69?q=80&w=400', active: true },
      { id: 'p20', title: 'Ø¯Ø±Ø¹ Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠ ÙƒØ±ÙŠØ³ØªØ§Ù„', price: 85000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1510522134121-2238418b53c3?q=80&w=400', active: true }
    ];

    // Global state
    let isAdmin = false;
    let isOnline = !!window.supabase;

    // Authentication check
    async function checkAuth() {
      const loginPrompt = document.getElementById('loginPrompt');
      const adminContent = document.getElementById('adminContent');
      const logoutBtn = document.getElementById('logoutBtn');
      const offlineNotice = document.getElementById('offlineNotice');
      const seedSection = document.getElementById('seed-section');

      // Check if Supabase is available
      if (!window.supabase) {
        isOnline = false;
        offlineNotice.style.display = 'block';
        seedSection.style.display = 'none';
        adminContent.style.display = 'block';
        logoutBtn.style.display = 'none';
        loadOrders();
        loadStickers();
        return;
      }

      try {
        const { data: session } = await window.supabase.auth.getSession();
        if (!session?.session) {
          loginPrompt.style.display = 'block';
          adminContent.style.display = 'none';
          logoutBtn.style.display = 'none';
          return;
        }

        const user = session.session.user;
        const { data: profile } = await window.supabase
          .from('profiles')
          .select('is_admin')
          .eq('id', user.id)
          .single();

        if (profile?.is_admin) {
          isAdmin = true;
          adminContent.style.display = 'block';
          loginPrompt.style.display = 'none';
          logoutBtn.style.display = 'block';
          loadOrders();
          loadStickers();
        } else {
          loginPrompt.style.display = 'block';
          adminContent.style.display = 'none';
          logoutBtn.style.display = 'none';
        }
      } catch (e) {
        console.error('Auth error:', e);
        loginPrompt.style.display = 'block';
        adminContent.style.display = 'none';
        logoutBtn.style.display = 'none';
      }
    }

    // Logout function
    async function logout() {
      if (window.supabase) {
        await window.supabase.auth.signOut();
      }
      window.location.href = 'cohee.html';
    }

    // Load orders
    async function loadOrders() {
      const el = document.getElementById('orders');
      el.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--muted);"><i class="fa-solid fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</div>';

      try {
        let orders = [];
        if (isOnline) {
          const { data } = await window.supabase
            .from('orders')
            .select('*')
            .order('created_at', { ascending: false });
          orders = data || [];
        } else {
          orders = JSON.parse(localStorage.getItem('local_orders') || '[]');
        }

        if (!orders.length) {
          el.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--muted);">ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</div>';
          return;
        }

        el.innerHTML = orders.map(o => {
          const id = o.id || o.created_at;
          const itemsStr = (o.items || []).map(i => `${i.title} (x${i.qty})`).join(', ');
          return `
          <div class="order-card">
            <div class="order-header">
              <strong style="color: var(--primary); font-size: 1.1rem;">ğŸ‘¤ ${o.name || 'Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¬Ù‡ÙˆÙ„'}</strong>
              <span style="font-weight: 900; color: var(--accent);">${o.total} Ø¯.Ø¹</span>
            </div>
            <div class="customer-meta">
              <div class="meta-item"><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</strong> ${o.phone || 'ØºÙŠØ± Ù…Ø³Ø¬Ù„'}</div>
              <div class="meta-item"><strong>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</strong> ${o.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
              <div class="meta-item" style="grid-column: span 2;"><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</strong> ${o.address || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„'}</div>
            </div>
            <div class="order-items-list">
              <strong>ğŸ“¦ Ø§Ù„Ø¹Ù†Ø§ØµØ±:</strong><br>
              ${itemsStr || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ±'}
            </div>
            <div style="margin-top: 15px;">
              <button class="delete-order-btn" onclick="deleteOrder('${id}')">Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨</button>
            </div>
          </div>`;
        }).join('');
      } catch (e) {
        console.error('Error loading orders:', e);
        el.innerHTML = '<div style="color: red; padding: 20px;">âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>';
      }
    }

    // Delete order
    async function deleteOrder(id) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;
      
      try {
        if (isOnline) {
          await window.supabase.from('orders').delete().eq('id', id);
        } else {
          const orders = JSON.parse(localStorage.getItem('local_orders') || '[]');
          const filtered = orders.filter(o => String(o.id) !== String(id));
          localStorage.setItem('local_orders', JSON.stringify(filtered));
        }
        loadOrders();
      } catch (e) {
        alert('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨');
      }
    }

    // Load stickers
    async function loadStickers() {
      const el = document.getElementById('stList');
      el.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--muted);"><i class="fa-solid fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</div>';

      try {
        let data = [];
        if (isOnline) {
          const { data: stickers } = await window.supabase
            .from('stickers')
            .select('*')
            .order('created_at', { ascending: false });
          data = stickers || [];
        } else {
          data = JSON.parse(localStorage.getItem('stickers_local') || '[]');
        }

        if (!data.length) {
          el.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--muted);">ğŸ“¦ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</div>';
          return;
        }

        el.innerHTML = data.map(s => renderStickerRow(s)).join('');
      } catch (e) {
        console.error('Error loading stickers:', e);
        el.innerHTML = '<div style="color: red; padding: 20px;">âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>';
      }
    }

    // Render sticker row
    function renderStickerRow(s) {
      const id = s.id ?? s.title;
      const thumb = s.image_url ? `<img src="${s.image_url}" style="height:48px;width:48px;object-fit:cover;border-radius:6px;margin-inline-start:8px">` : '';
      const category = s.category ? `<div style="font-size:12px;color:var(--muted)">ÙØ¦Ø©: ${s.category}</div>` : '';
      return `
        <div id="st-row-${id}" class="st-row">
          <div style="display:flex;align-items:center">
            ${thumb}
            <div>
              <div class="st-info">${escapeHtml(s.title)} â€” ${s.price} Ø¯.Ø¹</div>
              ${category}
            </div>
          </div>
          <span class="st-actions">
            <button onclick="showEditForm('${id}')">ØªØ¹Ø¯ÙŠÙ„</button>
            <button onclick="deleteSticker('${id}')">Ø­Ø°Ù</button>
          </span>
          <div id="st-edit-${id}" style="display:none;margin-top:8px;padding:8px;background:#fafafa;border-radius:6px;grid-column:1/-1;">
            <input id="edit_title_${id}" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" value="${escapeHtml(s.title)}" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid #ddd;">
            <input id="edit_price_${id}" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" value="${s.price}" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid #ddd;">
            <input id="edit_category_${id}" placeholder="Ø§Ù„ØªØµÙ†ÙŠÙ" value="${escapeHtml(s.category || '')}" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid #ddd;">
            <div style="display:flex;gap:8px">
              <button type="button" onclick="saveStickerEdit('${id}')" style="flex:1;padding:8px;background:var(--primary);color:#fff;border:none;border-radius:4px;cursor:pointer;">Ø­ÙØ¸</button>
              <button type="button" onclick="cancelStickerEdit('${id}')" style="flex:1;padding:8px;background:#ddd;color:#333;border:none;border-radius:4px;cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
          </div>
        </div>`;
    }

    // Show edit form
    function showEditForm(id) {
      const form = document.getElementById(`st-edit-${id}`);
      if (form) form.style.display = 'block';
    }

    // Cancel edit
    function cancelStickerEdit(id) {
      const form = document.getElementById(`st-edit-${id}`);
      if (form) form.style.display = 'none';
    }

    // Save sticker edit
    async function saveStickerEdit(id) {
      const title = document.getElementById(`edit_title_${id}`).value;
      const price = parseFloat(document.getElementById(`edit_price_${id}`).value) || 0;
      const category = document.getElementById(`edit_category_${id}`).value || '';

      try {
        if (isOnline) {
          await window.supabase.from('stickers').update({ title, price, category }).eq('id', id);
        } else {
          const arr = JSON.parse(localStorage.getItem('stickers_local') || '[]');
          const idx = arr.findIndex(x => String(x.id) === String(id));
          if (idx > -1) {
            arr[idx].title = title;
            arr[idx].price = price;
            arr[idx].category = category;
            localStorage.setItem('stickers_local', JSON.stringify(arr));
          }
        }
        loadStickers();
      } catch (e) {
        alert('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬');
      }
    }

    // Seed sample data
    async function seedSampleData() {
      if (!isOnline) return alert('Supabase ØºÙŠØ± Ù…ØªØ§Ø­');
      if (!confirm('Ø³ÙŠØªÙ… Ø±ÙØ¹ 20 Ù…Ù†ØªØ¬. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) return;

      try {
        const cleanSamples = window._sampleProducts.map(s => ({
          title: s.title,
          price: s.price,
          category: s.category,
          image_url: s.thumb,
          active: true
        }));

        const { error } = await window.supabase.from('stickers').insert(cleanSamples);
        if (error) {
          alert('ÙØ´Ù„: ' + error.message);
        } else {
          alert('âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© 20 Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!');
          loadStickers();
        }
      } catch (e) {
        alert('Ø®Ø·Ø£: ' + e.message);
      }
    }

    // Add sticker
    async function addSticker(e) {
      e.preventDefault();
      const title = document.getElementById('st_title').value;
      const price = parseFloat(document.getElementById('st_price').value);
      const active = document.getElementById('st_active').checked;
      const category = document.getElementById('st_category').value || '';
      const file = document.getElementById('st_image').files?.[0];
      let image_url = '';

      try {
        if (file && isOnline && window.supabase?.storage) {
          try {
            const filename = `stickers/${Date.now()}_${file.name}`;
            const prog = document.getElementById('uploadProgress');
            prog.hidden = false;
            prog.value = 10;

            await window.supabase.storage.from('stickers').upload(filename, file, { upsert: true });
            prog.value = 80;

            const { data } = window.supabase.storage.from('stickers').getPublicUrl(filename);
            if (data?.publicUrl) image_url = data.publicUrl;
            prog.value = 100;
            prog.hidden = true;
          } catch (e) {
            console.warn('Upload failed, using local fallback');
          }
        }

        if (!image_url && file) {
          image_url = await new Promise((res, rej) => {
            const r = new FileReader();
            r.onload = () => res(r.result);
            r.onerror = rej;
            r.readAsDataURL(file);
          });
        }

        if (isOnline) {
          await window.supabase.from('stickers').insert([{ title, price, active, image_url, category }]);
        } else {
          const existing = JSON.parse(localStorage.getItem('stickers_local') || '[]');
          existing.unshift({ id: Date.now(), title, price, active, image_url, category });
          localStorage.setItem('stickers_local', JSON.stringify(existing));
        }

        document.getElementById('addSticker').reset();
        document.getElementById('previewWrap').style.display = 'none';
        loadStickers();
        alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­');
      } catch (e) {
        alert('âŒ Ø®Ø·Ø£: ' + e.message);
      }
    }

    // Delete sticker
    async function deleteSticker(id) {
      if (!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) return;

      try {
        if (isOnline) {
          await window.supabase.from('stickers').delete().eq('id', id);
        } else {
          const arr = JSON.parse(localStorage.getItem('stickers_local') || '[]');
          const filtered = arr.filter(x => String(x.id) !== String(id));
          localStorage.setItem('stickers_local', JSON.stringify(filtered));
        }
        loadStickers();
      } catch (e) {
        alert('âŒ Ø®Ø·Ø£: ' + e.message);
      }
    }

    // Escape HTML
    function escapeHtml(str) {
      if (!str) return '';
      return String(str)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;');
    }

    // Initialize on load
    document.addEventListener('DOMContentLoaded', async () => {
      await checkAuth();

      // Image preview
      document.getElementById('st_image')?.addEventListener('change', (e) => {
        const f = e.target.files?.[0];
        const wrap = document.getElementById('previewWrap');
        const img = document.getElementById('previewImg');
        if (!f) {
          wrap.style.display = 'none';
          img.src = '';
          return;
        }
        const reader = new FileReader();
        reader.onload = () => {
          img.src = reader.result;
          wrap.style.display = 'block';
        };
        reader.readAsDataURL(f);
      });
    });
  </script>



</body>

</html>