<!doctype html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="utf-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€” Ù…ØªØ¬Ø± ØºØ±ÙŠÙ…</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #4b5f76;
      --secondary: #5c7694;
      --bg-body: #f4f4f4;
      --border-color: #c6c8cb;
      --white: #ffffff;
      --text-main: #2c3e50;
      --text-light: #6c757d;
      --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 10px 30px rgba(0, 0, 0, 0.05);
      --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Cairo', sans-serif;
      background-color: var(--bg-body);
      color: var(--text-main);
      direction: rtl;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header */
    .site-header {
      background: var(--white);
      border-bottom: 1px solid var(--border-color);
      padding: 15px 0;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .header-inner {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 26px;
      font-weight: 800;
      color: var(--primary);
      letter-spacing: 1px;
      text-decoration: none;
    }

    .main-nav a,
    .main-nav button {
      color: var(--text-main);
      margin-right: 25px;
      font-weight: 600;
      font-size: 16px;
      text-decoration: none;
      background: none;
      border: none;
      cursor: pointer;
      font-family: inherit;
    }

    .main-nav a:hover,
    .main-nav button:hover {
      color: var(--secondary);
    }

    /* Admin-specific styles */
    .st-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 15px;
      align-items: center;
      padding: 20px;
      background: var(--white);
      border-radius: 16px;
      border: 1px solid var(--border-color);
      transition: var(--transition);
      margin-bottom: 12px;
    }

    .st-row:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
      border-color: var(--secondary);
    }

    .st-info {
      font-weight: 700;
      color: var(--primary);
      font-size: 1.05rem;
    }

    .st-actions {
      display: flex;
      gap: 10px;
    }

    .st-actions button {
      padding: 10px 16px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      background: var(--white);
      cursor: pointer;
      font-weight: 700;
      font-size: 0.85rem;
      transition: var(--transition);
      font-family: inherit;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .st-actions button:hover {
      background: var(--bg-body);
      border-color: var(--primary);
      color: var(--primary);
    }

    .order-card {
      background: var(--white);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 20px;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }

    .order-card:hover {
      box-shadow: var(--shadow-lg);
      border-color: var(--secondary);
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px dashed var(--border-color);
    }

    .customer-meta {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
      background: var(--bg-body);
      padding: 15px;
      border-radius: 12px;
    }

    .meta-item {
      font-size: 0.95rem;
      color: var(--text-main);
    }

    .meta-item strong {
      color: var(--text-light);
      font-weight: 500;
      display: block;
      margin-bottom: 5px;
      font-size: 0.8rem;
    }

    .order-items-list {
      background: var(--bg-body);
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
      font-size: 0.95rem;
      border-right: 4px solid var(--secondary);
    }

    .delete-order-btn {
      padding: 12px 24px;
      background: #fef2f2;
      color: #ef4444;
      border: 1px solid #fee2e2;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
      font-family: inherit;
    }

    .delete-order-btn:hover {
      background: #ef4444;
      color: #fff;
    }

    .admin-panel {
      animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .tab-btn {
      transition: var(--transition);
      position: relative;
    }

    .tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--primary);
      border-radius: 3px 3px 0 0;
    }

    .stat-card {
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    /* Buttons */
    .btn-primary {
      background: var(--primary);
      color: var(--white);
      padding: 15px 30px;
      border: none;
      border-radius: 12px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition);
      font-family: inherit;
    }

    .btn-primary:hover {
      background: var(--secondary);
      transform: translateY(-2px);
    }

    /* Form inputs */
    input,
    select,
    textarea {
      padding: 14px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      font-family: inherit;
      font-size: 0.95rem;
      outline: none;
      transition: var(--transition);
      background: var(--bg-body);
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--primary);
      background: var(--white);
      box-shadow: 0 0 0 3px rgba(75, 95, 118, 0.1);
    }

    /* Order Status Badges */
    .status-badge {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffc107;
    }

    .status-ready {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #17a2b8;
    }

    .status-delivered {
      background: #d4edda;
      color: #155724;
      border: 1px solid #28a745;
    }

    /* Order Status Tabs */
    .order-status-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .order-status-tab {
      padding: 10px 20px;
      border-radius: 25px;
      border: 2px solid var(--border-color);
      background: var(--white);
      cursor: pointer;
      font-weight: 600;
      font-family: inherit;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .order-status-tab:hover {
      border-color: var(--primary);
      background: var(--bg-body);
    }

    .order-status-tab.active {
      background: var(--primary);
      color: var(--white);
      border-color: var(--primary);
    }

    .order-status-tab .count {
      background: rgba(0, 0, 0, 0.1);
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
    }

    .order-status-tab.active .count {
      background: rgba(255, 255, 255, 0.2);
    }

    /* Status Action Buttons */
    .status-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 15px;
    }

    .status-btn {
      padding: 8px 16px;
      border-radius: 10px;
      border: 1px solid var(--border-color);
      background: var(--white);
      cursor: pointer;
      font-weight: 600;
      font-size: 0.85rem;
      transition: var(--transition);
      font-family: inherit;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
    }

    .status-btn.btn-pending {
      border-color: #ffc107;
      color: #856404;
    }

    .status-btn.btn-pending:hover {
      background: #fff3cd;
    }

    .status-btn.btn-ready {
      border-color: #17a2b8;
      color: #0c5460;
    }

    .status-btn.btn-ready:hover {
      background: #d1ecf1;
    }

    .status-btn.btn-delivered {
      border-color: #28a745;
      color: #155724;
    }

    .status-btn.btn-delivered:hover {
      background: #d4edda;
    }

    /* Quantity Control in Admin */
    .quantity-control {
      display: flex;
      align-items: center;
      gap: 5px;
      background: var(--bg-body);
      padding: 5px;
      border-radius: 10px;
      border: 1px solid var(--border-color);
    }

    .qty-btn {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: var(--white);
      cursor: pointer;
      font-weight: 700;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }

    .qty-btn:hover {
      background: var(--primary);
      color: var(--white);
      border-color: var(--primary);
    }

    .qty-input {
      width: 50px;
      text-align: center;
      border: none;
      background: transparent;
      font-weight: 700;
      font-size: 1rem;
    }

    /* ==================== RESPONSIVE DESIGN ==================== */

    /* Large Tablets (1024px) */
    @media (max-width: 1024px) {
      .container {
        padding: 0 15px;
      }

      #statsSection {
        grid-template-columns: repeat(2, 1fr) !important;
      }

      .customer-meta {
        grid-template-columns: 1fr 1fr;
      }
    }

    /* Tablets (768px) */
    @media (max-width: 768px) {

      /* Header */
      .header-inner {
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
      }

      .logo {
        font-size: 22px;
        order: -1;
        width: 100%;
        text-align: center;
      }

      .main-nav a,
      .main-nav button {
        margin-right: 15px;
        font-size: 14px;
      }

      /* Dashboard Header */
      #adminContent>div:first-child h1 {
        font-size: 1.8rem !important;
      }

      /* Stats Section */
      #statsSection {
        grid-template-columns: 1fr !important;
        gap: 15px !important;
      }

      .stat-card {
        padding: 20px !important;
      }

      .stat-card div[style*="font-size: 2.8rem"],
      .stat-card div[style*="font-size: 2.2rem"] {
        font-size: 2rem !important;
      }

      /* Tabs Navigation */
      div[style*="display: flex; gap: 30px; margin-bottom: 40px"] {
        gap: 15px !important;
        flex-wrap: wrap !important;
        justify-content: center !important;
      }

      .tab-btn {
        font-size: 0.95rem !important;
        padding: 12px 10px !important;
      }

      /* Admin Panels */
      .admin-panel,
      section[style*="background: var(--white); padding: 30px"] {
        padding: 20px !important;
        border-radius: 12px !important;
      }

      /* Form Grids */
      div[style*="grid-template-columns: 1fr 1fr"] {
        grid-template-columns: 1fr !important;
      }

      /* Product Row */
      .st-row {
        grid-template-columns: 1fr !important;
        gap: 12px;
        padding: 15px;
      }

      .st-actions {
        justify-content: flex-start;
        width: 100%;
      }

      .st-actions button {
        flex: 1;
        justify-content: center;
      }

      /* Order Card */
      .order-card {
        padding: 20px;
        border-radius: 15px;
      }

      .order-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .customer-meta {
        grid-template-columns: 1fr !important;
        gap: 10px;
      }

      .customer-meta .meta-item[style*="grid-column: span 2"] {
        grid-column: span 1 !important;
      }

      /* Order Status Tabs */
      .order-status-tabs {
        justify-content: center;
      }

      .order-status-tab {
        padding: 8px 15px;
        font-size: 0.9rem;
      }

      /* Status Actions */
      .status-actions {
        flex-direction: column;
      }

      .status-btn {
        width: 100%;
        justify-content: center;
      }

      /* Quantity Control */
      .quantity-control {
        padding: 4px;
      }

      .qty-btn {
        width: 28px;
        height: 28px;
        font-size: 14px;
      }

      .qty-input {
        width: 40px;
        font-size: 0.9rem;
      }
    }

    /* Mobile Phones (480px) */
    @media (max-width: 480px) {
      .container {
        padding: 0 10px;
      }

      /* Header */
      .site-header {
        padding: 10px 0;
      }

      .logo {
        font-size: 20px;
      }

      .main-nav a,
      .main-nav button {
        margin-right: 10px;
        font-size: 13px;
      }

      /* Dashboard Header */
      #adminContent>div:first-child {
        margin: 20px 0 !important;
        padding-bottom: 20px !important;
      }

      #adminContent>div:first-child h1 {
        font-size: 1.4rem !important;
      }

      #adminContent>div:first-child p {
        font-size: 0.85rem !important;
      }

      /* Stats */
      .stat-card {
        padding: 15px !important;
      }

      .stat-card div[style*="font-size: 2.8rem"],
      .stat-card div[style*="font-size: 2.2rem"] {
        font-size: 1.6rem !important;
      }

      /* Tabs */
      .tab-btn {
        font-size: 0.85rem !important;
        padding: 10px 5px !important;
        gap: 5px !important;
      }

      .tab-btn i {
        font-size: 1rem !important;
      }

      /* Forms */
      input,
      select,
      textarea {
        padding: 12px;
        font-size: 0.9rem;
      }

      button[style*="padding: 15px"] {
        padding: 12px !important;
        font-size: 0.9rem !important;
      }

      /* Product Row */
      .st-row {
        padding: 12px;
      }

      .st-info {
        font-size: 0.95rem;
      }

      .st-actions button {
        padding: 8px 12px;
        font-size: 0.8rem;
      }

      /* Order Card */
      .order-card {
        padding: 15px;
        border-radius: 12px;
      }

      .order-header strong {
        font-size: 1rem !important;
      }

      .meta-item {
        font-size: 0.85rem;
      }

      .meta-item strong {
        font-size: 0.75rem !important;
      }

      .order-items-list {
        padding: 12px;
        font-size: 0.85rem;
      }

      .delete-order-btn {
        padding: 10px 18px;
        font-size: 0.85rem;
        width: 100%;
      }

      /* Order Status Tabs */
      .order-status-tabs {
        gap: 8px;
      }

      .order-status-tab {
        padding: 6px 12px;
        font-size: 0.8rem;
        flex: 1;
        justify-content: center;
        min-width: 80px;
      }

      /* Status Badges */
      .status-badge {
        padding: 4px 10px;
        font-size: 0.7rem;
      }

      /* Quantity Control */
      .quantity-control {
        padding: 3px;
      }

      .qty-btn {
        width: 26px;
        height: 26px;
        font-size: 12px;
        border-radius: 6px;
      }

      .qty-input {
        width: 35px;
        font-size: 0.85rem;
      }

      /* Database Info Grid */
      div[style*="display: grid; grid-template-columns: 1fr 1fr; gap: 20px"] {
        grid-template-columns: 1fr !important;
        gap: 12px !important;
      }
    }

    /* Very Small Screens (360px) */
    @media (max-width: 360px) {
      .logo {
        font-size: 18px;
      }

      .main-nav a,
      .main-nav button {
        margin-right: 8px;
        font-size: 12px;
      }

      #adminContent>div:first-child h1 {
        font-size: 1.2rem !important;
      }

      .tab-btn {
        font-size: 0.75rem !important;
      }

      .order-status-tab {
        padding: 5px 8px;
        font-size: 0.7rem;
      }
    }
  </style>
</head>


<body>
  <header class="site-header">
    <div class="container header-inner">
      <nav class="main-nav">
        <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <button id="logoutBtn" onclick="logout()" style="display: none;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
      </nav>

      <a href="index.html" class="logo">GHARIM</a>

      <div style="width: 100px;"></div>
    </div>
  </header>

  <main class="container" style="padding-bottom: 60px;">
    <!-- Offline Notice -->
    <div id="offlineNotice" class="offline-banner"
      style="display:none; margin: 20px 0; padding: 15px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; color: #856404; text-align: center;">
      âš ï¸ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„: Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ (localStorage)
    </div>

    <!-- Login Prompt -->
    <div id="loginPrompt" style="display: none; text-align: center; padding: 100px 20px;">
      <div style="max-width: 400px; margin: 0 auto;">
        <i class="fa-solid fa-lock"
          style="font-size: 3rem; color: var(--primary); margin-bottom: 20px; display: block;"></i>
        <h2 style="color: var(--primary); font-size: 2rem; margin-bottom: 15px; font-weight: 900;">ÙˆØµÙˆÙ„ Ù…Ù‚ÙŠØ¯</h2>
        <p style="color: var(--muted); font-size: 1rem; margin-bottom: 30px; line-height: 1.6;">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©
          ØªØªØ·Ù„Ø¨ Ø­Ø³Ø§Ø¨Ù‹Ø§ Ù…ØµØ±Ø­Ù‹Ø§. ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù…ØªØ§Ø¨Ø¹Ø©.</p>
        <a href="auth.html"
          style="display: inline-block; background: var(--primary); color: #fff; padding: 15px 40px; border-radius: 50px; text-decoration: none; font-weight: 700; font-size: 1rem; transition: all 0.3s; box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);">ØªØ³Ø¬ÙŠÙ„
          Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
      </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminContent" style="display: none;">
      <!-- Dashboard Header -->
      <div style="margin: 40px 0 30px; padding-bottom: 30px; border-bottom: 2px solid var(--accent-light);">
        <h1 style="color: var(--primary); font-size: 2.5rem; font-weight: 900; margin-bottom: 10px;">
          <i class="fa-solid fa-chart-line"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        </h1>
        <p style="color: var(--muted); font-size: 0.95rem;">Ø£Ø¯ÙØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Ù‡Ù†Ø§</p>
      </div>

      <!-- Stats Section -->
      <div id="statsSection"
        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 40px;">
        <div class="stat-card"
          style="background: var(--white); padding: 30px; border-radius: 20px; box-shadow: var(--shadow-sm); border-right: 5px solid var(--accent);">
          <div style="font-size: 0.9rem; color: var(--muted); margin-bottom: 10px; font-weight: 500;">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
          </div>
          <div style="display: flex; align-items: baseline; gap: 10px;">
            <div style="font-size: 2.8rem; font-weight: 900; color: var(--primary);" id="statsProducts">0</div>
            <div style="color: var(--muted); font-size: 0.9rem;">Ù…Ù†ØªØ¬</div>
          </div>
        </div>
        <div class="stat-card"
          style="background: var(--white); padding: 30px; border-radius: 20px; box-shadow: var(--shadow-sm); border-right: 5px solid #22c55e;">
          <div style="font-size: 0.9rem; color: var(--muted); margin-bottom: 10px; font-weight: 500;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
          </div>
          <div style="display: flex; align-items: baseline; gap: 10px;">
            <div style="font-size: 2.8rem; font-weight: 900; color: #15803d;" id="statsOrders">0</div>
            <div style="color: var(--muted); font-size: 0.9rem;">Ø·Ù„Ø¨</div>
          </div>
        </div>
        <div class="stat-card"
          style="background: var(--white); padding: 30px; border-radius: 20px; box-shadow: var(--shadow-sm); border-right: 5px solid #3b82f6;">
          <div style="font-size: 0.9rem; color: var(--muted); margin-bottom: 10px; font-weight: 500;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
          </div>
          <div style="display: flex; align-items: baseline; gap: 5px;">
            <div style="font-size: 2.2rem; font-weight: 900; color: #1d4ed8;" id="statsRevenue">0</div>
            <div style="color: var(--muted); font-size: 0.8rem;">Ø¯.Ø¹</div>
          </div>
        </div>
      </div>

      <!-- Tabs Navigation -->
      <div style="display: flex; gap: 30px; margin-bottom: 40px; border-bottom: 1px solid #eef2f6; position: relative;">
        <button onclick="switchTab('products')" class="tab-btn active"
          style="padding: 15px 5px; background: none; border: none; color: var(--primary); font-weight: 700; cursor: pointer; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;">
          <i class="fa-solid fa-boxes-stacked" style="font-size: 1.2rem;"></i> Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        </button>
        <button onclick="switchTab('orders')" class="tab-btn"
          style="padding: 15px 5px; background: none; border: none; color: var(--muted); font-weight: 700; cursor: pointer; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;">
          <i class="fa-solid fa-file-invoice-dollar" style="font-size: 1.2rem;"></i> Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        </button>
        <button onclick="switchTab('tools')" class="tab-btn"
          style="padding: 15px 5px; background: none; border: none; color: var(--muted); font-weight: 700; cursor: pointer; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;">
          <i class="fa-solid fa-sliders" style="font-size: 1.2rem;"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        </button>
      </div>

      <!-- Products Tab -->
      <div id="productsTab">
        <!-- Add Product Form -->
        <section class="admin-panel"
          style="background: var(--white); padding: 30px; border-radius: 15px; box-shadow: var(--shadow-md); border: 1px solid rgba(197, 160, 33, 0.1); margin-bottom: 30px;">
          <h2 style="color: var(--primary); margin-bottom: 25px; display: flex; align-items: center; gap: 10px;">
            <i class="fa-solid fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
          </h2>
          <form id="addSticker" onsubmit="addSticker(event)" style="display: grid; gap: 20px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
              <input id="st_title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†ØªØ¬" required
                style="padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-family: inherit; font-size: 0.95rem;">
              <input id="st_price" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø¯.Ø¹)" type="number" required
                style="padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-family: inherit; font-size: 0.95rem;">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
              <input id="st_category" placeholder="Ø§Ù„ØªØµÙ†ÙŠÙ (ØªÙˆØ²ÙŠØ¹Ø§ØªØŒ Ù…ØµØ§Ø­Ù...)"
                style="padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-family: inherit; font-size: 0.95rem;">
              <input id="st_quantity" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø©" type="number" min="0" value="0"
                style="padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-family: inherit; font-size: 0.95rem;">
            </div>

            <textarea id="st_description" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" rows="3"
              style="padding: 12px; border-radius: 8px; border: 1px solid #ddd; font-family: inherit; font-size: 0.95rem; resize: vertical;"></textarea>

            <div style="display: flex; align-items: center; gap: 10px;">
              <input id="st_active" type="checkbox" checked
                style="width: 20px; height: 20px; accent-color: var(--primary);">
              <label for="st_active" style="font-weight: 600;">Ù…ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø±</label>
            </div>

            <div
              style="padding: 20px; background: var(--bg); border: 2px dashed var(--accent); border-radius: 10px; text-align: center;">
              <label style="display: block; margin-bottom: 10px; font-weight: 700; color: var(--primary);">ØµÙˆØ±Ø©
                Ø§Ù„Ù…Ù†ØªØ¬</label>
              <input id="st_image" type="file" accept="image/*" style="cursor: pointer;">
              <div id="previewWrap" style="margin-top:15px;display:none">
                <img id="previewImg" src=""
                  style="max-width:150px; border-radius:10px; display:inline-block; margin-bottom:10px; box-shadow: var(--shadow-sm);">
                <progress id="uploadProgress" value="0" max="100" style="width:100%; height: 8px; border-radius: 4px;"
                  hidden></progress>
              </div>
            </div>

            <button
              style="background: var(--primary); color: #fff; padding: 15px; border: none; border-radius: 10px; font-weight: 700; font-size: 1rem; cursor: pointer; transition: all 0.3s;">
              <i class="fa-solid fa-check"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬
            </button>
          </form>
        </section>

        <!-- Products List -->
        <section
          style="background: var(--white); padding: 30px; border-radius: 15px; box-shadow: var(--shadow-md); border: 1px solid rgba(197, 160, 33, 0.1);">
          <h3 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
            <i class="fa-solid fa-list"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (<span id="productCount">0</span>)
          </h3>
          <div id="stList" style="display: grid; gap: 12px;"></div>
        </section>
      </div>

      <!-- Orders Tab -->
      <div id="ordersTab" style="display: none;">
        <section
          style="background: var(--white); padding: 30px; border-radius: 15px; box-shadow: var(--shadow-md); border: 1px solid rgba(197, 160, 33, 0.1);">
          <h3 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
            <i class="fa-solid fa-receipt"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª (<span id="orderCount">0</span>)
          </h3>

          <!-- Order Status Tabs -->
          <div class="order-status-tabs">
            <button class="order-status-tab active" onclick="filterOrders('all')" data-status="all">
              <i class="fa-solid fa-list"></i> Ø§Ù„ÙƒÙ„
              <span class="count" id="countAll">0</span>
            </button>
            <button class="order-status-tab" onclick="filterOrders('pending')" data-status="pending">
              <i class="fa-solid fa-clock"></i> Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²
              <span class="count" id="countPending">0</span>
            </button>
            <button class="order-status-tab" onclick="filterOrders('ready')" data-status="ready">
              <i class="fa-solid fa-box"></i> Ø¬Ø§Ù‡Ø²Ø©
              <span class="count" id="countReady">0</span>
            </button>
            <button class="order-status-tab" onclick="filterOrders('delivered')" data-status="delivered">
              <i class="fa-solid fa-check-circle"></i> ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…
              <span class="count" id="countDelivered">0</span>
            </button>
          </div>

          <div id="orders" style="display: grid; gap: 15px;"></div>
        </section>
      </div>

      <!-- Tools Tab -->
      <div id="toolsTab" style="display: none;">
        <div style="display: grid; gap: 20px;">
          <!-- Seed Section -->
          <section
            style="background: linear-gradient(135deg, var(--accent-light), #fef8e7); padding: 30px; border-radius: 15px; border: 2px solid var(--accent);">
            <h3 style="color: var(--primary); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
              <i class="fa-solid fa-database"></i> Ù…Ø²Ø§Ù…Ù†Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø¯Ø¡
            </h3>
            <p style="color: var(--text); margin-bottom: 20px; font-size: 0.95rem;">Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„ 20 Ù…Ù†ØªØ¬ ØªÙˆØ¶ÙŠØ­ÙŠ Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø©
              Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ. Ù‡Ø°Ø§ ÙŠØ³Ø§Ø¹Ø¯ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù….</p>
            <button onclick="seedSampleData()"
              style="background: var(--accent); color: #fff; border: none; padding: 12px 25px; border-radius: 10px; font-weight: 700; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px;">
              <i class="fa-solid fa-arrow-down"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            </button>
          </section>

          <!-- Database Info -->
          <section
            style="background: var(--white); padding: 30px; border-radius: 15px; box-shadow: var(--shadow-md); border: 1px solid rgba(197, 160, 33, 0.1);">
            <h3 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
              <i class="fa-solid fa-info-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
            </h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
              <div
                style="background: var(--bg); padding: 15px; border-radius: 10px; border-right: 4px solid var(--primary);">
                <div style="font-size: 0.85rem; color: var(--muted); margin-bottom: 5px;">Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„</div>
                <div id="connectionStatus" style="font-size: 1.2rem; font-weight: 700; color: var(--primary);">
                  <i class="fa-solid fa-check-circle"></i> Ù…ØªØµÙ„
                </div>
              </div>
              <div
                style="background: var(--bg); padding: 15px; border-radius: 10px; border-right: 4px solid var(--primary);">
                <div style="font-size: 0.85rem; color: var(--muted); margin-bottom: 5px;">ÙˆØ¶Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ†</div>
                <div id="storageMode" style="font-size: 1.2rem; font-weight: 700; color: var(--primary);">
                  <i class="fa-solid fa-database"></i> Supabase
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase.js"></script>

  <script>
    // Sample products for seeding
    window._sampleProducts = [
      { id: 'p1', title: 'ØªÙˆØ²ÙŠØ¹Ø§Øª Ø¨Ø®ÙˆØ± Ù…Ù„ÙƒÙŠ', price: 5000, category: 'ØªÙˆØ²ÙŠØ¹Ø§Øª', thumb: 'https://images.unsplash.com/photo-1628144450171-ec59a117cb83?q=80&w=400', active: true },
      { id: 'p2', title: 'Ù…ØµØ­Ù Ø§Ù„Ø¬ÙŠØ¨ Ù…ØºÙ„Ù', price: 7500, category: 'ØªÙˆØ²ÙŠØ¹Ø§Øª', thumb: 'https://images.unsplash.com/photo-1542810634-71277d95dcbb?q=80&w=400', active: true },
      { id: 'p3', title: 'Ø³Ø¨Ø­Ø© Ø§Ù„Ø¹Ù‚ÙŠÙ‚ Ø§Ù„ÙØ§Ø®Ø±Ø©', price: 15000, category: 'ØªÙˆØ²ÙŠØ¹Ø§Øª', thumb: 'https://images.unsplash.com/photo-1590074259010-8636cb077e69?q=80&w=400', active: true },
      { id: 'p4', title: 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ø®ÙˆØ± ÙˆØ¹ÙˆØ¯', price: 25000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1541675154750-0444c7d51e8e?q=80&w=400', active: true },
      { id: 'p13', title: 'Ø¹Ù„Ø¨Ø© Ù‡Ø¯Ø§ÙŠØ§ Ø®Ø´Ø¨ÙŠØ© Ù…Ø­ÙÙˆØ±Ø©', price: 12500, category: 'ØªÙˆØ²ÙŠØ¹Ø§Øª', thumb: 'https://images.unsplash.com/photo-1549465220-1a8b9238cd48?q=80&w=400', active: true },
      { id: 'p5', title: 'Ù…ØµØ­Ù Ù…Ø®Ù…Ù„ÙŠ ÙƒØ¨ÙŠØ±', price: 35000, category: 'Ù…ØµØ§Ø­Ù', thumb: 'https://images.unsplash.com/photo-1597933534024-bcbb64dfd6f6?q=80&w=400', active: true },
      { id: 'p6', title: 'Ø­Ø§Ù…Ù„ Ù…ØµØ­Ù Ø®Ø´Ø¨ÙŠ', price: 45000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1584281729155-320077819323?q=80&w=400', active: true },
      { id: 'p7', title: 'Ø·Ù‚Ù… ØµÙ„Ø§Ø© Ù…ØªÙƒØ§Ù…Ù„', price: 65000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1564683214965-3619add9800d?q=80&w=400', active: true },
      { id: 'p14', title: 'Ù…ØµØ­Ù Ø¨Ø§Ù„ØªØ¬Ù„ÙŠØ¯ Ø§Ù„Ø°Ù‡Ø¨ÙŠ', price: 55000, category: 'Ù…ØµØ§Ø­Ù', thumb: 'https://images.unsplash.com/photo-1609599006353-e629aaabfeae?q=80&w=400', active: true },
      { id: 'p8', title: 'Ù‚Ù†ÙŠÙ†Ø© Ø¹Ø·Ø± Ø²ÙŠØªÙŠØ© ÙØ®Ù…Ø©', price: 12000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1523293182086-7651a899d37f?q=80&w=400', active: true },
      { id: 'p9', title: 'Ø¹Ù„Ø¨Ø© Ù‡Ø¯Ø§ÙŠØ§ Ù…Ø·Ø±Ø²Ø©', price: 8500, category: 'ØªÙˆØ²ÙŠØ¹Ø§Øª', thumb: 'https://images.unsplash.com/photo-1549465220-1a8b9238cd48?q=80&w=400', active: true },
      { id: 'p10', title: 'ÙØ§Ù†ÙˆØ³ Ø±Ù…Ø¶Ø§Ù†ÙŠ ÙŠØ¯ÙˆÙŠ', price: 18000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1558227691-41ea78d1f631?q=80&w=400', active: true },
      { id: 'p11', title: 'Ù„ÙˆØ­Ø© Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠ Ù…Ø°Ù‡Ø¨Ø©', price: 95000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1510522134121-2238418b53c3?q=80&w=400', active: true },
      { id: 'p12', title: 'Ø³Ø¬Ø§Ø¯Ø© ØµÙ„Ø§Ø© Ø·Ø¨ÙŠØ©', price: 40000, category: 'Ù…ØµØ§Ø­Ù', thumb: 'https://images.unsplash.com/photo-1554433607-66b5efe9d304?q=80&w=400', active: true },
      { id: 'p15', title: 'ØµÙ†Ø¯ÙˆÙ‚ Ø¨Ø®ÙˆØ± Ø§Ù„ØµÙ†Ø¯Ù„', price: 17000, category: 'ØªÙˆØ²ÙŠØ¹Ø§Øª', thumb: 'https://images.unsplash.com/photo-1628144450171-ec59a117cb83?q=80&w=400', active: true },
      { id: 'p16', title: 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø£Ø°ÙƒØ§Ø± Ø§Ù„ÙØ§Ø®Ø±Ø©', price: 9000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1542810634-71277d95dcbb?q=80&w=400', active: true },
      { id: 'p17', title: 'Ø¨Ø³Ø§Ø· ØµÙ„Ø§Ø© Ø£Ø«Ø±ÙŠ', price: 120000, category: 'Ù…ØµØ§Ø­Ù', thumb: 'https://images.unsplash.com/photo-1554433607-66b5efe9d304?q=80&w=400', active: true },
      { id: 'p18', title: 'Ù…Ø¨Ø®Ø±Ø© Ù†Ø­Ø§Ø³ÙŠØ© ÙŠØ¯ÙˆÙŠØ©', price: 32000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1541675154750-0444c7d51e8e?q=80&w=400', active: true },
      { id: 'p19', title: 'Ø·Ù‚Ù… Ø³Ø¨Ø­Ø© ÙˆÙ…ØµØ­Ù Ø¬ÙŠØ¨', price: 14000, category: 'ØªÙˆØ²ÙŠØ¹Ø§Øª', thumb: 'https://images.unsplash.com/photo-1590074259010-8636cb077e69?q=80&w=400', active: true },
      { id: 'p20', title: 'Ø¯Ø±Ø¹ Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠ ÙƒØ±ÙŠØ³ØªØ§Ù„', price: 85000, category: 'Ù‡Ø¯Ø§ÙŠØ§', thumb: 'https://images.unsplash.com/photo-1510522134121-2238418b53c3?q=80&w=400', active: true }
    ];

    // Global state
    let isAdmin = false;
    let isOnline = !!window.supabase;

    // Tab switching
    function switchTab(tabName) {
      // Hide all tabs
      document.getElementById('productsTab').style.display = 'none';
      document.getElementById('ordersTab').style.display = 'none';
      document.getElementById('toolsTab').style.display = 'none';

      // Show selected tab
      document.getElementById(tabName + 'Tab').style.display = 'block';

      // Update tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.style.color = 'var(--muted)';
      });

      const activeBtn = event.currentTarget;
      activeBtn.classList.add('active');
      activeBtn.style.color = 'var(--primary)';

      // Load data for the tab
      if (tabName === 'orders') loadOrders();
      if (tabName === 'tools') updateConnectionStatus();
    }

    // Update stats
    async function updateStats() {
      try {
        let products = [];
        let orders = [];
        let revenue = 0;

        if (isOnline) {
          const { data: prods } = await window.supabase.from('stickers').select('*');
          const { data: ords } = await window.supabase.from('orders').select('*');
          products = prods || [];
          orders = ords || [];
        } else {
          products = JSON.parse(localStorage.getItem('stickers_local') || '[]');
          orders = JSON.parse(localStorage.getItem('local_orders') || '[]');
        }

        orders.forEach(o => revenue += o.total || 0);

        document.getElementById('statsProducts').textContent = products.length;
        document.getElementById('statsOrders').textContent = orders.length;
        document.getElementById('statsRevenue').textContent = revenue.toLocaleString('ar-IQ') + ' Ø¯.Ø¹';
        document.getElementById('productCount').textContent = products.length;
        document.getElementById('orderCount').textContent = orders.length;
      } catch (e) {
        console.error('Error updating stats:', e);
      }
    }

    // Update connection status
    function updateConnectionStatus() {
      const status = document.getElementById('connectionStatus');
      const mode = document.getElementById('storageMode');

      if (isOnline) {
        status.innerHTML = '<i class="fa-solid fa-check-circle" style="color: #4CAF50;"></i> Ù…ØªØµÙ„';
        mode.innerHTML = '<i class="fa-solid fa-cloud"></i> Supabase';
      } else {
        status.innerHTML = '<i class="fa-solid fa-exclamation-circle" style="color: #ff9800;"></i> ØºÙŠØ± Ù…ØªØµÙ„';
        mode.innerHTML = '<i class="fa-solid fa-database"></i> localStorage';
      }
    }

    // Authentication check
    async function checkAuth() {
      const loginPrompt = document.getElementById('loginPrompt');
      const adminContent = document.getElementById('adminContent');
      const logoutBtn = document.getElementById('logoutBtn');
      const offlineNotice = document.getElementById('offlineNotice');

      // Check if Supabase is available
      if (!window.supabase) {
        isOnline = false;
        offlineNotice.style.display = 'block';
        adminContent.style.display = 'block';
        logoutBtn.style.display = 'none';
        updateStats();
        loadStickers();
        return;
      }

      try {
        const { data: session, error: sessionError } = await window.supabase.auth.getSession();
        console.log('Session check:', session, sessionError);

        if (!session?.session) {
          console.log('No active session found');
          loginPrompt.style.display = 'block';
          adminContent.style.display = 'none';
          logoutBtn.style.display = 'none';
          return;
        }

        const user = session.session.user;
        console.log('User logged in:', user.id, user.email);

        // Try to get profile, but allow access if table doesn't exist or no profile found
        const { data: profile, error: profileError } = await window.supabase
          .from('profiles')
          .select('is_admin')
          .eq('id', user.id)
          .single();

        console.log('Profile check:', profile, profileError);

        // Allow access if: profile exists with is_admin=true, OR if profile table has issues (allow authenticated users)
        if (profile?.is_admin === true) {
          console.log('Admin access granted via profile');
          isAdmin = true;
          adminContent.style.display = 'block';
          loginPrompt.style.display = 'none';
          logoutBtn.style.display = 'block';
          updateStats();
          loadStickers();
        } else if (profileError && profileError.code === 'PGRST116') {
          // No profile found - create one and allow access
          console.log('No profile found, creating one...');
          await window.supabase.from('profiles').insert({ id: user.id, is_admin: true });
          isAdmin = true;
          adminContent.style.display = 'block';
          loginPrompt.style.display = 'none';
          logoutBtn.style.display = 'block';
          updateStats();
          loadStickers();
        } else {
          console.log('Access denied - is_admin:', profile?.is_admin);
          loginPrompt.style.display = 'block';
          adminContent.style.display = 'none';
          logoutBtn.style.display = 'none';
        }
      } catch (e) {
        console.error('Auth error:', e);
        loginPrompt.style.display = 'block';
        adminContent.style.display = 'none';
        logoutBtn.style.display = 'none';
      }
    }

    // Logout function
    async function logout() {
      if (window.supabase) {
        await window.supabase.auth.signOut();
      }
      window.location.href = 'index.html';
    }

    // Load orders
    let allOrders = [];
    let currentStatusFilter = 'all';

    async function loadOrders() {
      const el = document.getElementById('orders');
      el.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--muted);"><i class="fa-solid fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';

      try {
        if (isOnline) {
          const { data } = await window.supabase
            .from('orders')
            .select('*')
            .order('created_at', { ascending: false });
          allOrders = data || [];
        } else {
          allOrders = JSON.parse(localStorage.getItem('local_orders') || '[]');
        }

        // Ensure all orders have a status
        allOrders = allOrders.map(o => ({
          ...o,
          status: o.status || 'pending'
        }));

        updateOrderCounts();
        renderOrders();
      } catch (e) {
        console.error('Error loading orders:', e);
        el.innerHTML = '<div style="color: red; padding: 20px;">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</div>';
      }
    }

    // Update order counts for each status
    function updateOrderCounts() {
      const pending = allOrders.filter(o => o.status === 'pending').length;
      const ready = allOrders.filter(o => o.status === 'ready').length;
      const delivered = allOrders.filter(o => o.status === 'delivered').length;

      document.getElementById('countAll').textContent = allOrders.length;
      document.getElementById('countPending').textContent = pending;
      document.getElementById('countReady').textContent = ready;
      document.getElementById('countDelivered').textContent = delivered;
    }

    // Filter orders by status
    function filterOrders(status) {
      currentStatusFilter = status;

      // Update active tab
      document.querySelectorAll('.order-status-tab').forEach(tab => {
        tab.classList.remove('active');
        if (tab.dataset.status === status) {
          tab.classList.add('active');
        }
      });

      renderOrders();
    }

    // Render orders based on current filter
    function renderOrders() {
      const el = document.getElementById('orders');

      let filteredOrders = allOrders;
      if (currentStatusFilter !== 'all') {
        filteredOrders = allOrders.filter(o => o.status === currentStatusFilter);
      }

      if (!filteredOrders.length) {
        el.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--muted);">ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…</div>';
        return;
      }

      el.innerHTML = filteredOrders.map(o => {
        const id = o.id || o.created_at;
        const itemsStr = (o.items || []).map(i => `${i.title} (x${i.qty})`).join(', ');
        const status = o.status || 'pending';

        // Status badge
        let statusBadge = '';
        if (status === 'pending') {
          statusBadge = '<span class="status-badge status-pending"><i class="fa-solid fa-clock"></i> Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</span>';
        } else if (status === 'ready') {
          statusBadge = '<span class="status-badge status-ready"><i class="fa-solid fa-box"></i> Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ³Ù„ÙŠÙ…</span>';
        } else if (status === 'delivered') {
          statusBadge = '<span class="status-badge status-delivered"><i class="fa-solid fa-check-circle"></i> ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</span>';
        }

        // Format date
        const orderDate = o.created_at ? new Date(o.created_at).toLocaleDateString('ar-IQ', {
          year: 'numeric',
          month: 'short',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        }) : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

        return `
        <div class="order-card" data-order-id="${id}" data-status="${status}">
          <div class="order-header">
            <div style="display: flex; flex-direction: column; gap: 8px;">
              <strong style="color: var(--primary); font-size: 1.1rem;">ğŸ‘¤ ${o.name || 'Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¬Ù‡ÙˆÙ„'}</strong>
              ${statusBadge}
            </div>
            <div style="text-align: left;">
              <div style="font-weight: 900; color: var(--primary); font-size: 1.2rem;">${(o.total || 0).toLocaleString('ar-IQ')} Ø¯.Ø¹</div>
              <div style="font-size: 0.8rem; color: var(--text-light);">ğŸ“… ${orderDate}</div>
            </div>
          </div>
          <div class="customer-meta">
            <div class="meta-item">
              <strong><i class="fa-solid fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</strong> 
              <a href="tel:${o.phone}" style="color: var(--primary); text-decoration: none;">${o.phone || 'ØºÙŠØ± Ù…Ø³Ø¬Ù„'}</a>
            </div>
            <div class="meta-item">
              <strong><i class="fa-solid fa-map-marker-alt"></i> Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</strong> 
              ${o.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
            </div>
            <div class="meta-item" style="grid-column: span 2;">
              <strong><i class="fa-solid fa-home"></i> Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</strong> 
              ${o.address || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„'}
            </div>
            ${o.notes ? `<div class="meta-item" style="grid-column: span 2;"><strong><i class="fa-solid fa-sticky-note"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª</strong> ${o.notes}</div>` : ''}
          </div>
          <div class="order-items-list">
            <strong>ğŸ“¦ Ø§Ù„Ø¹Ù†Ø§ØµØ±:</strong><br>
            ${itemsStr || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ±'}
          </div>
          
          <!-- Status Actions -->
          <div class="status-actions">
            ${status !== 'pending' ? `<button class="status-btn btn-pending" onclick="updateOrderStatus('${id}', 'pending')"><i class="fa-solid fa-clock"></i> Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</button>` : ''}
            ${status !== 'ready' ? `<button class="status-btn btn-ready" onclick="updateOrderStatus('${id}', 'ready')"><i class="fa-solid fa-box"></i> Ø¬Ø§Ù‡Ø²</button>` : ''}
            ${status !== 'delivered' ? `<button class="status-btn btn-delivered" onclick="updateOrderStatus('${id}', 'delivered')"><i class="fa-solid fa-check-circle"></i> ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</button>` : ''}
            <button class="delete-order-btn" onclick="deleteOrder('${id}')"><i class="fa-solid fa-trash"></i> Ø­Ø°Ù</button>
          </div>
        </div>`;
      }).join('');
    }

    // Update order status
    async function updateOrderStatus(id, newStatus) {
      try {
        if (isOnline) {
          await window.supabase.from('orders').update({ status: newStatus }).eq('id', id);
        } else {
          const orders = JSON.parse(localStorage.getItem('local_orders') || '[]');
          const idx = orders.findIndex(o => String(o.id) === String(id) || String(o.created_at) === String(id));
          if (idx > -1) {
            orders[idx].status = newStatus;
            localStorage.setItem('local_orders', JSON.stringify(orders));
          }
        }

        // Update local state
        const orderIdx = allOrders.findIndex(o => String(o.id) === String(id) || String(o.created_at) === String(id));
        if (orderIdx > -1) {
          allOrders[orderIdx].status = newStatus;
        }

        updateOrderCounts();
        renderOrders();

        // Show toast notification
        showToast(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰: ${getStatusLabel(newStatus)}`);
      } catch (e) {
        console.error('Error updating order status:', e);
        alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨');
      }
    }

    // Get status label
    function getStatusLabel(status) {
      switch (status) {
        case 'pending': return 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²';
        case 'ready': return 'Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ³Ù„ÙŠÙ…';
        case 'delivered': return 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…';
        default: return status;
      }
    }

    // Show toast notification
    function showToast(message) {
      const existing = document.querySelector('.toast-notification');
      if (existing) existing.remove();

      const toast = document.createElement('div');
      toast.className = 'toast-notification';
      toast.style.cssText = 'position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--primary); color: var(--white); padding: 15px 30px; border-radius: 50px; z-index: 9999; box-shadow: var(--shadow-lg); font-weight: 700; animation: slideUp 0.3s ease-out;';
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => toast.remove(), 3000);
    }

    // Delete order
    async function deleteOrder(id) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;

      try {
        if (isOnline) {
          await window.supabase.from('orders').delete().eq('id', id);
        } else {
          const orders = JSON.parse(localStorage.getItem('local_orders') || '[]');
          const filtered = orders.filter(o => String(o.id) !== String(id) && String(o.created_at) !== String(id));
          localStorage.setItem('local_orders', JSON.stringify(filtered));
        }
        loadOrders();
        updateStats();
      } catch (e) {
        alert('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨');
      }
    }

    // Load stickers
    async function loadStickers() {
      const el = document.getElementById('stList');
      el.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--muted);"><i class="fa-solid fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';

      try {
        let data = [];
        if (isOnline) {
          const { data: stickers } = await window.supabase
            .from('stickers')
            .select('*')
            .order('created_at', { ascending: false });
          data = stickers || [];
        } else {
          data = JSON.parse(localStorage.getItem('stickers_local') || '[]');
        }

        if (!data.length) {
          el.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--muted);">ğŸ“¦ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</div>';
          return;
        }

        el.innerHTML = data.map(s => renderStickerRow(s)).join('');
      } catch (e) {
        console.error('Error loading stickers:', e);
        el.innerHTML = '<div style="color: red; padding: 20px;">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</div>';
      }
    }

    // Render sticker row
    function renderStickerRow(s) {
      const id = s.id ?? s.title;
      const thumb = s.image_url ? `<img src="${s.image_url}" style="height:48px;width:48px;object-fit:cover;border-radius:6px;margin-inline-start:8px">` : '';
      const category = s.category ? `<div style="font-size:12px;color:var(--muted)">ÙØ¦Ø©: ${s.category}</div>` : '';

      // Quantity display with warning for low stock
      const quantity = s.quantity ?? 0;
      let quantityBadge = '';
      if (quantity === 0) {
        quantityBadge = '<span style="background:#ff4444;color:#fff;padding:4px 10px;border-radius:12px;font-size:11px;font-weight:700;margin-right:8px">ğŸ“¦ Ù†ÙØ° Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span>';
      } else if (quantity < 10) {
        quantityBadge = `<span style="background:#ff9800;color:#fff;padding:4px 10px;border-radius:12px;font-size:11px;font-weight:700;margin-right:8px">âš ï¸ Ø§Ù„ÙƒÙ…ÙŠØ©: ${quantity}</span>`;
      } else {
        quantityBadge = `<span style="background:#4CAF50;color:#fff;padding:4px 10px;border-radius:12px;font-size:11px;font-weight:700;margin-right:8px">âœ“ Ø§Ù„ÙƒÙ…ÙŠØ©: ${quantity}</span>`;
      }

      const description = s.description ? `<div style="font-size:12px;color:var(--muted);margin-top:4px;font-style:italic">${escapeHtml(s.description.substring(0, 80))}${s.description.length > 80 ? '...' : ''}</div>` : '';

      return `
        <div id="st-row-${id}" class="st-row">
          <div style="display:flex;align-items:center">
            ${thumb}
            <div style="flex:1">
              <div class="st-info">${escapeHtml(s.title)} â€” ${s.price} Ø¯.Ø¹ ${quantityBadge}</div>
              ${category}
              ${description}
            </div>
          </div>
          <span class="st-actions">
            <button onclick="showEditForm('${id}')"><i class="fa-solid fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„</button>
            <button onclick="deleteSticker('${id}')" style="background: #ff4444; color: #fff;"><i class="fa-solid fa-trash"></i> Ø­Ø°Ù</button>
          </span>
          <div id="st-edit-${id}" style="display:none;margin-top:8px;padding:8px;background:#fafafa;border-radius:6px;grid-column:1/-1;">
            <input id="edit_title_${id}" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" value="${escapeHtml(s.title)}" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid #ddd;">
            <input id="edit_price_${id}" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" value="${s.price}" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid #ddd;">
            <input id="edit_category_${id}" placeholder="Ø§Ù„ØªØµÙ†ÙŠÙ" value="${escapeHtml(s.category || '')}" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid #ddd;">
            <input id="edit_quantity_${id}" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" value="${quantity}" min="0" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid #ddd;">
            <textarea id="edit_description_${id}" placeholder="Ø§Ù„ÙˆØµÙ" rows="2" style="width:100%;padding:8px;margin-bottom:8px;border-radius:4px;border:1px solid #ddd;resize:vertical;font-family:inherit;">${escapeHtml(s.description || '')}</textarea>
            <div style="display:flex;gap:8px">
              <button type="button" onclick="saveStickerEdit('${id}')" style="flex:1;padding:8px;background:var(--primary);color:#fff;border:none;border-radius:4px;cursor:pointer;"><i class="fa-solid fa-check"></i> Ø­ÙØ¸</button>
              <button type="button" onclick="cancelStickerEdit('${id}')" style="flex:1;padding:8px;background:#ddd;color:#333;border:none;border-radius:4px;cursor:pointer;"><i class="fa-solid fa-times"></i> Ø¥Ù„ØºØ§Ø¡</button>
            </div>
          </div>
        </div>`;
    }

    // Show edit form
    function showEditForm(id) {
      const form = document.getElementById(`st-edit-${id}`);
      if (form) form.style.display = 'block';
    }

    // Cancel edit
    function cancelStickerEdit(id) {
      const form = document.getElementById(`st-edit-${id}`);
      if (form) form.style.display = 'none';
    }

    // Save sticker edit
    async function saveStickerEdit(id) {
      const title = document.getElementById(`edit_title_${id}`).value;
      const price = parseFloat(document.getElementById(`edit_price_${id}`).value) || 0;
      const category = document.getElementById(`edit_category_${id}`).value || '';
      const quantity = parseInt(document.getElementById(`edit_quantity_${id}`).value) || 0;
      const description = document.getElementById(`edit_description_${id}`).value || '';

      try {
        if (isOnline) {
          await window.supabase.from('stickers').update({ title, price, category, quantity, description }).eq('id', id);
        } else {
          const arr = JSON.parse(localStorage.getItem('stickers_local') || '[]');
          const idx = arr.findIndex(x => String(x.id) === String(id));
          if (idx > -1) {
            arr[idx].title = title;
            arr[idx].price = price;
            arr[idx].category = category;
            arr[idx].quantity = quantity;
            arr[idx].description = description;
            localStorage.setItem('stickers_local', JSON.stringify(arr));
          }
        }
        loadStickers();
        updateStats();
      } catch (e) {
        alert('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬');
      }
    }

    // Seed sample data
    async function seedSampleData() {
      if (!isOnline) return alert('Supabase ØºÙŠØ± Ù…ØªØ§Ø­');
      if (!confirm('Ø³ÙŠØªÙ… Ø±ÙØ¹ 20 Ù…Ù†ØªØ¬ ØªÙˆØ¶ÙŠØ­ÙŠ. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) return;

      try {
        const cleanSamples = window._sampleProducts.map(s => ({
          title: s.title,
          price: s.price,
          category: s.category,
          image_url: s.thumb,
          active: true
        }));

        const { error } = await window.supabase.from('stickers').insert(cleanSamples);
        if (error) {
          alert('ÙØ´Ù„: ' + error.message);
        } else {
          alert('âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© 20 Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!');
          loadStickers();
          updateStats();
        }
      } catch (e) {
        alert('Ø®Ø·Ø£: ' + e.message);
      }
    }

    // Add sticker
    async function addSticker(e) {
      e.preventDefault();
      const title = document.getElementById('st_title').value;
      const price = parseFloat(document.getElementById('st_price').value);
      const active = document.getElementById('st_active').checked;
      const category = document.getElementById('st_category').value || '';
      const quantity = parseInt(document.getElementById('st_quantity').value) || 0;
      const description = document.getElementById('st_description').value || '';
      const file = document.getElementById('st_image').files?.[0];
      let image_url = '';

      try {
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Base64 Ù…Ø¨Ø§Ø´Ø±Ø©
        if (file) {
          const prog = document.getElementById('uploadProgress');
          prog.hidden = false;
          prog.value = 30;

          image_url = await new Promise((res, rej) => {
            const reader = new FileReader();
            reader.onload = () => res(reader.result);
            reader.onerror = rej;
            reader.readAsDataURL(file);
          });

          prog.value = 100;
          setTimeout(() => { prog.hidden = true; }, 500);
        }

        if (isOnline) {
          const { error } = await window.supabase.from('stickers').insert([{ title, price, active, image_url, category, quantity, description }]);
          if (error) {
            alert('Ø®Ø·Ø£: ' + error.message);
            return;
          }
        } else {
          const existing = JSON.parse(localStorage.getItem('stickers_local') || '[]');
          existing.unshift({ id: Date.now(), title, price, active, image_url, category, quantity, description });
          localStorage.setItem('stickers_local', JSON.stringify(existing));
        }

        document.getElementById('addSticker').reset();
        document.getElementById('previewWrap').style.display = 'none';
        loadStickers();
        updateStats();
        alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­');
      } catch (e) {
        alert('âŒ Ø®Ø·Ø£: ' + e.message);
      }
    }

    // Delete sticker
    async function deleteSticker(id) {
      if (!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) return;

      try {
        if (isOnline) {
          await window.supabase.from('stickers').delete().eq('id', id);
        } else {
          const arr = JSON.parse(localStorage.getItem('stickers_local') || '[]');
          const filtered = arr.filter(x => String(x.id) !== String(id));
          localStorage.setItem('stickers_local', JSON.stringify(filtered));
        }
        loadStickers();
        updateStats();
      } catch (e) {
        alert('âŒ Ø®Ø·Ø£: ' + e.message);
      }
    }

    // Escape HTML
    function escapeHtml(str) {
      if (!str) return '';
      return String(str)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;');
    }

    // Initialize on load
    document.addEventListener('DOMContentLoaded', async () => {
      await checkAuth();

      // Image preview
      document.getElementById('st_image')?.addEventListener('change', (e) => {
        const f = e.target.files?.[0];
        const wrap = document.getElementById('previewWrap');
        const img = document.getElementById('previewImg');
        if (!f) {
          wrap.style.display = 'none';
          img.src = '';
          return;
        }
        const reader = new FileReader();
        reader.onload = () => {
          img.src = reader.result;
          wrap.style.display = 'block';
        };
        reader.readAsDataURL(f);
      });
    });
  </script>



</body>

</html>